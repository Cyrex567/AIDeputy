<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI-Deputy - The Global Infrastructure for Psychological Stabilization.">
    <title>AI-Deputy | Psychological Stabilization Infrastructure</title>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- GSAP for Animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'midnight': '#0A0A0B',
                        'surface': '#111113',
                        'surface-light': '#1A1A1D',
                        'clinical-teal': '#0D9488',
                        'clinical-blue': '#1E40AF',
                    },
                    fontFamily: {
                        'inter': ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: #0A0A0B;
            color: #FAFAFA;
            display: flex;
            flex-direction: column;
        }

        /* Main Layout */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
        }

        /* Header */
        .app-header {
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            flex-shrink: 0;
        }

        /* Mode Selector */
        .mode-selector {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 4px;
            gap: 4px;
        }

        .mode-btn {
            padding: 0.5rem 1.25rem;
            border-radius: 8px;
            font-size: 0.8125rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.5);
            min-width: 90px;
            text-align: center;
        }

        .mode-btn:hover {
            color: rgba(255, 255, 255, 0.8);
        }

        .mode-btn.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .mode-btn.active.deputy {
            background: linear-gradient(135deg, rgba(13, 148, 136, 0.35), rgba(13, 148, 136, 0.15));
            color: #5EEAD4;
            box-shadow: 0 2px 8px rgba(13, 148, 136, 0.2);
        }

        .mode-btn.active.rcr {
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.35), rgba(30, 64, 175, 0.15));
            color: #93C5FD;
            box-shadow: 0 2px 8px rgba(30, 64, 175, 0.2);
        }

        /* Settings Button */
        .settings-btn {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.04);
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.9);
            border-color: rgba(255, 255, 255, 0.2);
        }

        /* Settings Modal */
        .settings-modal {
            position: fixed;
            inset: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .settings-modal.open {
            opacity: 1;
            visibility: visible;
        }

        .settings-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }

        .settings-panel {
            position: relative;
            width: 90%;
            max-width: 520px;
            max-height: 85vh;
            background: #111113;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            transform: translateY(20px) scale(0.95);
            transition: transform 0.3s ease;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
        }

        .settings-modal.open .settings-panel {
            transform: translateY(0) scale(1);
        }

        .settings-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .settings-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: white;
        }

        .settings-close {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .settings-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .settings-content {
            overflow-y: auto;
            padding: 1rem 1.5rem 1.5rem;
            flex: 1;
        }

        .settings-section {
            margin-bottom: 1.75rem;
        }

        .settings-section:last-child {
            margin-bottom: 0;
        }

        /* RAG Status */
        .rag-status {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.25rem;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 14px;
        }

        .rag-status-icon {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(251, 191, 36, 0.05));
            border: 1px solid rgba(251, 191, 36, 0.3);
            color: #FCD34D;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rag-status-icon.custom {
            background: linear-gradient(135deg, rgba(13, 148, 136, 0.2), rgba(13, 148, 136, 0.05));
            border-color: rgba(13, 148, 136, 0.3);
            color: #5EEAD4;
        }

        .rag-status-text {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .rag-status-label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.4);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .rag-status-value {
            font-size: 0.9375rem;
            font-weight: 500;
            color: white;
        }

        /* Section Titles */
        .section-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: white;
            margin-bottom: 0.375rem;
        }

        .section-desc {
            font-size: 0.8125rem;
            color: rgba(255, 255, 255, 0.4);
            margin-bottom: 1rem;
        }

        /* Upload Zone */
        .upload-zone {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            border: 2px dashed rgba(255, 255, 255, 0.12);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .upload-zone:hover {
            border-color: rgba(255, 255, 255, 0.25);
            background: rgba(255, 255, 255, 0.02);
        }

        .upload-zone.dragover {
            border-color: #0D9488;
            background: rgba(13, 148, 136, 0.05);
        }

        .upload-icon {
            width: 32px;
            height: 32px;
            color: rgba(255, 255, 255, 0.3);
            margin-bottom: 0.75rem;
        }

        .upload-text {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 0.25rem;
        }

        .upload-hint {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.3);
        }

        /* File List */
        .file-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.625rem 0.875rem;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
        }

        .file-item-info {
            display: flex;
            align-items: center;
            gap: 0.625rem;
        }

        .file-item-icon {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            background: rgba(13, 148, 136, 0.15);
            color: #5EEAD4;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .file-item-name {
            font-size: 0.8125rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .file-item-remove {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .file-item-remove:hover {
            background: rgba(239, 68, 68, 0.15);
            color: #EF4444;
        }

        /* Profile Fields */
        .profile-fields {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .field-group {
            display: flex;
            flex-direction: column;
            gap: 0.375rem;
        }

        .field-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.5);
        }

        .field-input,
        .field-textarea {
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-size: 0.875rem;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .field-input:focus,
        .field-textarea:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.25);
            background: rgba(255, 255, 255, 0.06);
        }

        .field-input::placeholder,
        .field-textarea::placeholder {
            color: rgba(255, 255, 255, 0.25);
        }

        .field-textarea {
            min-height: 80px;
            resize: vertical;
        }

        /* Settings Footer */
        .settings-footer {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            margin-top: 0.5rem;
        }

        .btn-secondary,
        .btn-primary {
            padding: 0.625rem 1.25rem;
            border-radius: 10px;
            font-size: 0.8125rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.06);
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0D9488, #14B8A6);
            color: white;
            box-shadow: 0 2px 8px rgba(13, 148, 136, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.4);
        }

        /* Chat Area */
        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 2rem 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        /* Messages Container */
        #messages-container {
            display: flex;
            flex-direction: column;
            gap: 1.75rem;
        }

        /* Welcome State */
        .welcome-state {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
            min-height: 0;
        }

        .welcome-logo {
            width: 72px;
            height: 72px;
            border-radius: 22px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.04));
            border: 1px solid rgba(255, 255, 255, 0.12);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.75rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .welcome-title {
            font-size: 1.625rem;
            font-weight: 600;
            margin-bottom: 0.625rem;
            background: linear-gradient(135deg, #fff, rgba(255, 255, 255, 0.75));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }

        .welcome-subtitle {
            color: rgba(255, 255, 255, 0.45);
            font-size: 0.9375rem;
            max-width: 380px;
            line-height: 1.7;
            margin: 0 auto;
        }

        .quick-prompts {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.625rem;
            margin-top: 2.25rem;
            max-width: 440px;
            width: 100%;
        }

        .quick-prompt {
            padding: 0.75rem 1.125rem;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            font-size: 0.8125rem;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            white-space: nowrap;
        }

        .quick-prompt:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.16);
            color: rgba(255, 255, 255, 0.95);
            transform: translateY(-1px);
        }

        /* Messages - Unique Minimal Design */
        .message {
            display: flex;
            flex-direction: column;
            max-width: 100%;
            opacity: 0;
            transform: translateY(8px);
            animation: messageIn 0.35s ease-out forwards;
            padding-left: 1rem;
            position: relative;
        }

        @keyframes messageIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Accent line indicator */
        .message::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0.25rem;
            bottom: 0.25rem;
            width: 2px;
            border-radius: 2px;
            transition: all 0.2s ease;
        }

        .message.ai::before {
            background: linear-gradient(180deg, #0D9488, #14B8A6);
        }

        .message.ai.rcr-mode::before {
            background: linear-gradient(180deg, #1E40AF, #3B82F6);
        }

        .message.user::before {
            background: rgba(255, 255, 255, 0.25);
        }

        /* Message label */
        .message-label {
            font-size: 0.6875rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            opacity: 0.5;
        }

        .message.ai .message-label {
            color: #5EEAD4;
        }

        .message.ai.rcr-mode .message-label {
            color: #93C5FD;
        }

        .message.user .message-label {
            color: rgba(255, 255, 255, 0.6);
        }

        .message-content {
            max-width: 100%;
        }

        .message-text {
            font-size: 0.9375rem;
            line-height: 1.7;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 400;
        }

        .message.user .message-text {
            color: rgba(255, 255, 255, 0.75);
        }

        /* Typing Indicator */
        .typing-dots {
            display: flex;
            gap: 5px;
            padding: 0.25rem 0;
        }

        .typing-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: #0D9488;
            animation: typingBounce 1.4s infinite;
        }

        .message.rcr-mode .typing-dot {
            background: #3B82F6;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingBounce {

            0%,
            60%,
            100% {
                transform: translateY(0);
            }

            30% {
                transform: translateY(-4px);
            }
        }

        /* Input Area */
        .input-area {
            padding: 1rem 1.5rem 1.25rem;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
        }

        .input-container {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 14px;
            padding: 0.625rem 0.875rem;
            transition: all 0.2s ease;
        }

        .input-container:focus-within {
            border-color: rgba(255, 255, 255, 0.18);
            background: rgba(255, 255, 255, 0.06);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.03);
        }

        .chat-input {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            font-size: 0.9375rem;
            outline: none;
            resize: none;
            min-height: 24px;
            max-height: 120px;
            line-height: 1.5;
            padding: 0.25rem 0;
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.35);
        }

        .send-btn {
            width: 38px;
            height: 38px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            background: linear-gradient(135deg, #0D9488, #14B8A6);
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(13, 148, 136, 0.3);
        }

        .send-btn.rcr-mode {
            background: linear-gradient(135deg, #1E40AF, #3B82F6);
            box-shadow: 0 2px 8px rgba(30, 64, 175, 0.3);
        }

        .send-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.4);
        }

        .send-btn.rcr-mode:hover:not(:disabled) {
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.4);
        }

        .send-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Footer Info */
        .footer-info {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 0.75rem 0;
            margin-top: 0.5rem;
            font-size: 0.6875rem;
            color: rgba(255, 255, 255, 0.3);
            letter-spacing: 0.025em;
            min-height: 2rem;
        }

        /* Scrollbar */
        .chat-area::-webkit-scrollbar {
            width: 6px;
        }

        .chat-area::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-area::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .chat-area::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Bilateral Waveform - subtle background */
        .bilateral-wave {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 200px;
            pointer-events: none;
            opacity: 0.4;
            z-index: 0;
        }
    </style>
</head>

<body>
    <!-- Subtle Background Waveform -->
    <canvas id="bilateral-wave" class="bilateral-wave"></canvas>

    <!-- Main App Container -->
    <div class="app-container relative z-10">

        <!-- Header -->
        <header class="app-header">
            <div class="flex items-center gap-3">
                <div
                    class="w-9 h-9 rounded-xl bg-gradient-to-br from-white/10 to-white/5 flex items-center justify-center border border-white/10">
                    <svg class="w-5 h-5 text-white/80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                            d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                </div>
                <span class="text-base font-semibold tracking-tight">AI-Deputy</span>
            </div>

            <!-- Mode Selector -->
            <div class="mode-selector">
                <button id="btn-deputy" class="mode-btn active deputy">AI-Deputy</button>
                <button id="btn-rcr" class="mode-btn rcr">RCR</button>
            </div>

            <div class="flex items-center gap-3">
                <div class="flex items-center gap-2 text-xs text-white/30">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                            d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                    <span>Encrypted</span>
                </div>
                <button id="settings-btn" class="settings-btn" title="Settings">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </button>
            </div>
        </header>

        <!-- Settings Modal -->
        <div id="settings-modal" class="settings-modal">
            <div class="settings-overlay"></div>
            <div class="settings-panel">
                <div class="settings-header">
                    <h2 class="settings-title">Settings</h2>
                    <button id="settings-close" class="settings-close">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <div class="settings-content">
                    <!-- RAG Status -->
                    <div class="settings-section">
                        <div class="rag-status">
                            <div class="rag-status-icon" id="rag-status-icon">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                        d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                </svg>
                            </div>
                            <div class="rag-status-text">
                                <span class="rag-status-label">Clinical Protocol Source</span>
                                <span class="rag-status-value" id="rag-status-value">Using Generic Library</span>
                            </div>
                        </div>
                    </div>

                    <!-- Clinical Protocols -->
                    <div class="settings-section">
                        <h3 class="section-title">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            Clinical Protocols
                        </h3>
                        <p class="section-desc">Upload RCR/EMDR protocols and approved clinical phrases</p>
                        <div class="upload-zone" id="protocols-upload">
                            <input type="file" id="protocols-input" multiple accept=".txt,.pdf,.doc,.docx,.json" hidden>
                            <svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                            <span class="upload-text">Drop files or click to upload</span>
                            <span class="upload-hint">TXT, PDF, DOC, JSON</span>
                        </div>
                        <div class="file-list" id="protocols-list"></div>
                    </div>

                    <!-- Email Responses -->
                    <div class="settings-section">
                        <h3 class="section-title">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                    d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                            </svg>
                            Email Response Templates
                        </h3>
                        <p class="section-desc">Add your typical client email responses for tone matching</p>
                        <div class="upload-zone" id="emails-upload">
                            <input type="file" id="emails-input" multiple accept=".txt,.eml,.pdf" hidden>
                            <svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                            <span class="upload-text">Drop files or click to upload</span>
                            <span class="upload-hint">TXT, EML, PDF</span>
                        </div>
                        <div class="file-list" id="emails-list"></div>
                    </div>

                    <!-- Practitioner Profile -->
                    <div class="settings-section">
                        <h3 class="section-title">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                            Practitioner Profile
                        </h3>
                        <p class="section-desc">Add personal data to customize AI responses to your style</p>
                        <div class="profile-fields">
                            <div class="field-group">
                                <label class="field-label">Name / Title</label>
                                <input type="text" id="practitioner-name" class="field-input"
                                    placeholder="Dr. Jane Smith">
                            </div>
                            <div class="field-group">
                                <label class="field-label">Therapeutic Approach</label>
                                <input type="text" id="practitioner-approach" class="field-input"
                                    placeholder="e.g., CBT, EMDR, Somatic">
                            </div>
                            <div class="field-group">
                                <label class="field-label">Custom Grounding Phrases</label>
                                <textarea id="practitioner-phrases" class="field-textarea"
                                    placeholder="Enter phrases you commonly use with clients..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Reset -->
                    <div class="settings-section settings-footer">
                        <button id="reset-rag" class="btn-secondary">Reset to Generic Library</button>
                        <button id="save-settings" class="btn-primary">Save Configuration</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Area -->
        <div id="chat-area" class="chat-area">
            <!-- Welcome State (shown when no messages) -->
            <div id="welcome-state" class="welcome-state">
                <div class="welcome-logo">
                    <svg class="w-8 h-8 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                            d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                    </svg>
                </div>
                <h1 class="welcome-title">What's on your mind?</h1>
                <p class="welcome-subtitle">I'm here as a delegated therapeutic presence. Not automation—continuous
                    stabilization when you need it.</p>

                <div class="quick-prompts">
                    <button class="quick-prompt" data-prompt="I've been feeling overwhelmed lately">Feeling
                        overwhelmed</button>
                    <button class="quick-prompt" data-prompt="Can we do a grounding exercise?">Grounding
                        exercise</button>
                    <button class="quick-prompt" data-prompt="I need someone to talk to">Just need to talk</button>
                    <button class="quick-prompt" data-prompt="Help me with bilateral stimulation">Bilateral
                        stimulation</button>
                </div>
            </div>

            <!-- Messages Container -->
            <div id="messages-container"></div>
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <div class="input-container">
                <textarea id="chat-input" class="chat-input" placeholder="Message AI-Deputy..." rows="1"></textarea>
                <button id="send-btn" class="send-btn" disabled>
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                    </svg>
                </button>
            </div>
            <p class="footer-info">AI-Deputy · Global Infrastructure for Psychological Stabilization</p>
        </div>

    </div>

    <script>
        // ========================================
        // DOM ELEMENTS
        // ========================================
        const chatArea = document.getElementById('chat-area');
        const messagesContainer = document.getElementById('messages-container');
        const welcomeState = document.getElementById('welcome-state');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const btnDeputy = document.getElementById('btn-deputy');
        const btnRcr = document.getElementById('btn-rcr');
        const quickPrompts = document.querySelectorAll('.quick-prompt');

        // Settings Modal Elements
        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const settingsClose = document.getElementById('settings-close');
        const settingsOverlay = document.querySelector('.settings-overlay');
        const ragStatusIcon = document.getElementById('rag-status-icon');
        const ragStatusValue = document.getElementById('rag-status-value');
        const protocolsUpload = document.getElementById('protocols-upload');
        const protocolsInput = document.getElementById('protocols-input');
        const protocolsList = document.getElementById('protocols-list');
        const emailsUpload = document.getElementById('emails-upload');
        const emailsInput = document.getElementById('emails-input');
        const emailsList = document.getElementById('emails-list');
        const resetRagBtn = document.getElementById('reset-rag');
        const saveSettingsBtn = document.getElementById('save-settings');

        let currentMode = 'deputy'; // 'deputy' or 'rcr'
        let hasMessages = false;

        // RAG Configuration State
        const ragConfig = {
            protocols: [],
            emails: [],
            practitioner: {
                name: '',
                approach: '',
                phrases: ''
            },
            isCustom: false
        };

        // ========================================
        // MODE SWITCHING
        // ========================================
        btnDeputy.addEventListener('click', () => {
            if (currentMode === 'deputy') return;
            currentMode = 'deputy';
            btnDeputy.classList.add('active');
            btnRcr.classList.remove('active');
            sendBtn.classList.remove('rcr-mode');
            chatInput.placeholder = 'Message AI-Deputy...';
            updateAvatars();
        });

        btnRcr.addEventListener('click', () => {
            if (currentMode === 'rcr') return;
            currentMode = 'rcr';
            btnRcr.classList.add('active');
            btnDeputy.classList.remove('active');
            sendBtn.classList.add('rcr-mode');
            chatInput.placeholder = 'Message RCR Protocol...';
            updateAvatars();
        });

        function updateAvatars() {
            document.querySelectorAll('.message-avatar.ai').forEach(avatar => {
                avatar.classList.toggle('rcr-mode', currentMode === 'rcr');
            });
        }

        // ========================================
        // SETTINGS MODAL
        // ========================================
        function openSettings() {
            settingsModal.classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeSettings() {
            settingsModal.classList.remove('open');
            document.body.style.overflow = '';
        }

        settingsBtn.addEventListener('click', openSettings);
        settingsClose.addEventListener('click', closeSettings);
        settingsOverlay.addEventListener('click', closeSettings);

        // Close on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && settingsModal.classList.contains('open')) {
                closeSettings();
            }
        });

        // File Upload Functionality
        function setupUploadZone(zone, input, list, fileArray, category) {
            zone.addEventListener('click', () => input.click());

            zone.addEventListener('dragover', (e) => {
                e.preventDefault();
                zone.classList.add('dragover');
            });

            zone.addEventListener('dragleave', () => {
                zone.classList.remove('dragover');
            });

            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                zone.classList.remove('dragover');
                handleFiles(e.dataTransfer.files, fileArray, list, category);
            });

            input.addEventListener('change', (e) => {
                handleFiles(e.target.files, fileArray, list, category);
                input.value = '';
            });
        }

        function handleFiles(files, fileArray, list, category) {
            Array.from(files).forEach(file => {
                if (!fileArray.some(f => f.name === file.name)) {
                    fileArray.push(file);
                    addFileToList(file, fileArray, list, category);
                }
            });
            updateRagStatus();
        }

        function addFileToList(file, fileArray, list, category) {
            const item = document.createElement('div');
            item.className = 'file-item';
            item.innerHTML = `
                <div class="file-item-info">
                    <div class="file-item-icon">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                    </div>
                    <span class="file-item-name">${file.name}</span>
                </div>
                <button class="file-item-remove" title="Remove">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            `;

            item.querySelector('.file-item-remove').addEventListener('click', () => {
                const index = fileArray.indexOf(file);
                if (index > -1) fileArray.splice(index, 1);
                item.remove();
                updateRagStatus();
            });

            list.appendChild(item);
        }

        function updateRagStatus() {
            const hasCustomData = ragConfig.protocols.length > 0 ||
                ragConfig.emails.length > 0 ||
                ragConfig.practitioner.name ||
                ragConfig.practitioner.approach ||
                ragConfig.practitioner.phrases;

            ragConfig.isCustom = hasCustomData;

            if (hasCustomData) {
                ragStatusIcon.classList.add('custom');
                ragStatusValue.textContent = 'Using Custom Library';
            } else {
                ragStatusIcon.classList.remove('custom');
                ragStatusValue.textContent = 'Using Generic Library';
            }
        }

        // Initialize upload zones
        setupUploadZone(protocolsUpload, protocolsInput, protocolsList, ragConfig.protocols, 'protocols');
        setupUploadZone(emailsUpload, emailsInput, emailsList, ragConfig.emails, 'emails');

        // Profile fields change handlers
        document.getElementById('practitioner-name').addEventListener('input', (e) => {
            ragConfig.practitioner.name = e.target.value;
            updateRagStatus();
        });

        document.getElementById('practitioner-approach').addEventListener('input', (e) => {
            ragConfig.practitioner.approach = e.target.value;
            updateRagStatus();
        });

        document.getElementById('practitioner-phrases').addEventListener('input', (e) => {
            ragConfig.practitioner.phrases = e.target.value;
            updateRagStatus();
        });

        // Reset RAG
        resetRagBtn.addEventListener('click', () => {
            ragConfig.protocols = [];
            ragConfig.emails = [];
            ragConfig.practitioner = { name: '', approach: '', phrases: '' };
            protocolsList.innerHTML = '';
            emailsList.innerHTML = '';
            document.getElementById('practitioner-name').value = '';
            document.getElementById('practitioner-approach').value = '';
            document.getElementById('practitioner-phrases').value = '';
            updateRagStatus();
        });

        // Save Settings
        saveSettingsBtn.addEventListener('click', () => {
            // Here you would send the configuration to your backend
            console.log('Saving RAG configuration:', ragConfig);

            // Store in localStorage for persistence
            localStorage.setItem('aiDeputyRagConfig', JSON.stringify({
                practitioner: ragConfig.practitioner,
                protocolFiles: ragConfig.protocols.map(f => f.name),
                emailFiles: ragConfig.emails.map(f => f.name),
                isCustom: ragConfig.isCustom
            }));

            // Show save confirmation
            const originalText = saveSettingsBtn.textContent;
            saveSettingsBtn.textContent = 'Saved!';
            setTimeout(() => {
                saveSettingsBtn.textContent = originalText;
                closeSettings();
            }, 1000);
        });

        // Load saved settings on startup
        function loadSavedSettings() {
            const saved = localStorage.getItem('aiDeputyRagConfig');
            if (saved) {
                const config = JSON.parse(saved);
                ragConfig.practitioner = config.practitioner || { name: '', approach: '', phrases: '' };
                document.getElementById('practitioner-name').value = ragConfig.practitioner.name || '';
                document.getElementById('practitioner-approach').value = ragConfig.practitioner.approach || '';
                document.getElementById('practitioner-phrases').value = ragConfig.practitioner.phrases || '';
                updateRagStatus();
            }
        }
        loadSavedSettings();

        // ========================================
        // CHAT FUNCTIONALITY
        // ========================================
        chatInput.addEventListener('input', () => {
            sendBtn.disabled = !chatInput.value.trim();
            // Auto-resize
            chatInput.style.height = 'auto';
            chatInput.style.height = Math.min(chatInput.scrollHeight, 120) + 'px';
        });

        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if (chatInput.value.trim()) {
                    sendMessage(chatInput.value.trim());
                }
            }
        });

        sendBtn.addEventListener('click', () => {
            if (chatInput.value.trim()) {
                sendMessage(chatInput.value.trim());
            }
        });

        quickPrompts.forEach(btn => {
            btn.addEventListener('click', () => {
                sendMessage(btn.dataset.prompt);
            });
        });

        async function sendMessage(text) {
            // Hide welcome state on first message
            if (!hasMessages) {
                welcomeState.style.display = 'none';
                hasMessages = true;
            }

            // Clear input
            chatInput.value = '';
            chatInput.style.height = 'auto';
            sendBtn.disabled = true;

            // Add user message
            addMessage(text, 'user');

            // Show typing indicator
            const typingEl = addTypingIndicator();

            // Get AI response
            const response = await AIDeputyAPI.sendMessage(text, currentMode);

            // Remove typing indicator and show response
            typingEl.remove();
            addMessage(response.text, 'ai');
        }

        function addMessage(text, type) {
            const messageEl = document.createElement('div');
            messageEl.className = `message ${type}${currentMode === 'rcr' && type === 'ai' ? ' rcr-mode' : ''}`;

            const label = type === 'ai'
                ? (currentMode === 'rcr' ? 'RCR Protocol' : 'AI-Deputy')
                : 'You';

            messageEl.innerHTML = `
                <div class="message-label">${label}</div>
                <div class="message-content">
                    <div class="message-text">${text}</div>
                </div>
            `;

            messagesContainer.appendChild(messageEl);
            chatArea.scrollTop = chatArea.scrollHeight;
            return messageEl;
        }

        function addTypingIndicator() {
            const typingEl = document.createElement('div');
            typingEl.className = `message ai${currentMode === 'rcr' ? ' rcr-mode' : ''}`;
            const label = currentMode === 'rcr' ? 'RCR Protocol' : 'AI-Deputy';
            typingEl.innerHTML = `
                <div class="message-label">${label}</div>
                <div class="message-content">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(typingEl);
            chatArea.scrollTop = chatArea.scrollHeight;
            return typingEl;
        }

        // ========================================
        // API INTEGRATION LAYER
        // ========================================
        const AIDeputyAPI = {
            endpoint: null, // Set to your backend URL
            sessionId: crypto.randomUUID(),
            onTTSStart: null,
            onTTSEnd: null,

            async sendMessage(message, mode) {
                if (!this.endpoint) {
                    return this.getDemoResponse(message, mode);
                }

                try {
                    const response = await fetch(this.endpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            message, mode, sessionId: this.sessionId,
                            timestamp: new Date().toISOString()
                        })
                    });

                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    const data = await response.json();

                    if (this.onTTSStart && data.text) {
                        this.onTTSStart(data.text, data.audioUrl);
                    }

                    return {
                        text: data.text || data.response || data.message,
                        audioUrl: data.audioUrl || null
                    };
                } catch (error) {
                    console.error('API Error:', error);
                    return { text: 'Connection interrupted. I\'m still here with you.', error: true };
                }
            },

            getDemoResponse(message, mode) {
                return new Promise(resolve => {
                    setTimeout(() => {
                        const responses = mode === 'deputy'
                            ? [
                                "I'm here with you. Take a moment to notice your breathing—what do you feel?",
                                "That takes courage to share. Let's stay with that feeling together.",
                                "You're safe here. What's one thing you can see right now?",
                                "I hear you. Your words matter, and I'm listening fully.",
                                "Let's ground together. Can you name three things you can touch around you?"
                            ]
                            : [
                                "Protocol acknowledged. Bilateral stabilization patterns active.",
                                "Processing across 2,847 concurrent sessions. Your input has been integrated.",
                                "System resilience maintained. Aggregate affect regulation at optimal levels.",
                                "Crisis response matrix updated. Continuing synchronized monitoring."
                            ];

                        resolve({
                            text: responses[Math.floor(Math.random() * responses.length)],
                            demo: true
                        });
                    }, 800 + Math.random() * 700);
                });
            },

            configure(options) {
                Object.assign(this, options);
                console.log('AI-Deputy API configured:', { endpoint: this.endpoint });
            }
        };

        window.AIDeputyAPI = AIDeputyAPI;

        // ========================================
        // BILATERAL WAVEFORM (subtle background)
        // ========================================
        const canvas = document.getElementById('bilateral-wave');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = window.innerWidth * 2;
            canvas.height = 400;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        let phase = 0;

        function drawWave() {
            const width = canvas.width;
            const height = canvas.height;
            ctx.clearRect(0, 0, width, height);

            const color = currentMode === 'deputy' ? '13, 148, 136' : '30, 64, 175';

            ctx.beginPath();
            ctx.moveTo(0, height);

            for (let x = 0; x < width; x++) {
                const bilateralOffset = Math.sin(phase) * (width * 0.15);
                const distFromCenter = Math.abs(x - (width / 2 + bilateralOffset));
                const falloff = Math.exp(-distFromCenter * 0.002);
                const y = height - 50 - Math.sin(x * 0.01 + phase * 2) * 30 * falloff;
                ctx.lineTo(x, y);
            }

            ctx.lineTo(width, height);
            ctx.closePath();

            const gradient = ctx.createLinearGradient(0, height - 100, 0, height);
            gradient.addColorStop(0, `rgba(${color}, 0.15)`);
            gradient.addColorStop(1, `rgba(${color}, 0)`);
            ctx.fillStyle = gradient;
            ctx.fill();

            phase += 0.015;
            requestAnimationFrame(drawWave);
        }

        drawWave();
    </script>
</body>

</html>
